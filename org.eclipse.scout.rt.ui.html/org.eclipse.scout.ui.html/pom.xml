<?xml version="1.0" encoding="UTF-8"?>
<!--
   Copyright (c) 2014 BSI Business Systems Integration AG.
   All rights reserved. This program and the accompanying materials
   are made available under the terms of the BSI AG Software License v1.0
   which accompanies this distribution as bsi-v10.html

-->
<project
  xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"
  xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <modelVersion>4.0.0</modelVersion>

  <parent>
    <groupId>org.eclipse.scout.rt.ui.html</groupId>
    <artifactId>org.eclipse.scout.rt.ui.html</artifactId>
    <version>4.0.0-SNAPSHOT</version>
  </parent>

  <artifactId>org.eclipse.scout.ui.html</artifactId>
  <packaging>eclipse-plugin</packaging>

  <properties>
    <script.input.dir>${project.basedir}/src/main/js</script.input.dir>
    <script.output.dir>../org.eclipse.scout.rt.ui.json/WebContent/res</script.output.dir>
    <scout.script.version>5.0.0</scout.script.version>
  </properties>

<build>
  <plugins>

    <plugin>
      <groupId>org.codehaus.mojo</groupId>
      <artifactId>exec-maven-plugin</artifactId>
      <version>1.2.1</version>
      <executions>
        <execution>
          <id>process-css</id>
          <phase>package</phase>
          <goals>
            <goal>java</goal>
          </goals>
          <configuration>
            <mainClass>org.eclipse.scout.ui.html.ScriptProcessor</mainClass>
            <arguments>
              <argument>--i</argument>
              <argument>${script.input.dir}/scout-template.css</argument>
              <argument>--o</argument>
              <argument>${project.build.directory}/process_script/scout-${scout.script.version}.css</argument>
              <argument>--root</argument>
              <argument>${project.basedir}</argument>
            </arguments>
            <classpathScope>compile</classpathScope>
          </configuration>
        </execution>
        <execution>
          <id>process-mobile-css</id>
          <phase>package</phase>
          <goals>
            <goal>java</goal>
          </goals>
          <configuration>
            <mainClass>org.eclipse.scout.ui.html.ScriptProcessor</mainClass>
            <arguments>
              <argument>--i</argument>
              <argument>${script.input.dir}/scout-mobile-template.css</argument>
              <argument>--o</argument>
              <argument>${project.build.directory}/process_script/scout-mobile-${scout.script.version}.css</argument>
              <argument>--root</argument>
              <argument>${project.basedir}</argument>
            </arguments>
            <classpathScope>compile</classpathScope>
          </configuration>
        </execution>
        <execution>
          <id>process-js</id>
          <phase>package</phase>
          <goals>
            <goal>java</goal>
          </goals>
          <configuration>
            <mainClass>org.eclipse.scout.ui.html.ScriptProcessor</mainClass>
            <arguments>
              <argument>--i</argument>
              <argument>${script.input.dir}/scout-template.js</argument>
              <argument>--o</argument>
              <argument>${project.build.directory}/process_script/scout-${scout.script.version}.js</argument>
              <argument>--root</argument>
              <argument>${project.basedir}</argument>
            </arguments>
            <classpathScope>compile</classpathScope>
          </configuration>
        </execution>
        <execution>
          <id>process-mobile-js</id>
          <phase>package</phase>
          <goals>
            <goal>java</goal>
          </goals>
          <configuration>
            <mainClass>org.eclipse.scout.ui.html.ScriptProcessor</mainClass>
            <arguments>
              <argument>--i</argument>
              <argument>${script.input.dir}/scout-mobile-template.js</argument>
              <argument>--o</argument>
              <argument>${project.build.directory}/process_script/scout-mobile-${scout.script.version}.js</argument>
              <argument>--root</argument>
              <argument>${project.basedir}</argument>
            </arguments>
            <classpathScope>compile</classpathScope>
          </configuration>
        </execution>
      </executions>

    </plugin>
    <plugin>
      <groupId>org.apache.maven.plugins</groupId>
      <artifactId>maven-antrun-plugin</artifactId>
      <version>1.7</version>
      <executions>
        <execution>
          <id>copy</id>
          <phase>package</phase>
          <configuration>
            <target name="copy fastclick to process_script for minimizing">
              <copy file="${project.basedir}/libjs/fastclickmod-1.0.1.js" tofile="${project.build.directory}/process_script/fastclickmod-1.0.1.js" />
            </target>
          </configuration>
          <goals>
            <goal>run</goal>
          </goals>
        </execution>
      </executions>
    </plugin>
    <plugin>
      <!-- Loads phantomjs executable, necessary for jasmine plugin -->
      <groupId>com.github.klieber</groupId>
      <artifactId>phantomjs-maven-plugin</artifactId>
      <version> 0.2.1</version>
      <executions>
        <execution>
          <goals>
            <goal>install</goal>
          </goals>
        </execution>
      </executions>
      <configuration>
        <version>1.9.2</version>
      </configuration>
    </plugin>

    <!-- JS testing with Jasmine -->
      <plugin>
        <groupId>com.github.searls</groupId>
        <artifactId>jasmine-maven-plugin</artifactId>
        <version>1.3.1.4</version>
        <executions>
          <execution>
            <goals>
              <goal>test</goal>
            </goals>
          </execution>
        </executions>
        <configuration>
          <jsSrcDir>${project.basedir}/src/main/js</jsSrcDir>
          <jsTestSrcDir>${project.basedir}/src/test/js</jsTestSrcDir>
          <customRunnerTemplate>${project.basedir}/src/test/js/SpecRunnerMaven.html</customRunnerTemplate>
          <sourceExcludes>
            <!-- jasmine files are explicitly included in SpecRunnerMaven.html because the need to be before actual sources-->
            <sourceExclude>**/jasmine/*.js</sourceExclude>
            <!-- for tests, scout namespace is defined in boot.ext.js -->
            <sourceExclude>scout-4.0.1-template.js</sourceExclude>
          </sourceExcludes>
          <!-- HtmlUnitDriver does not work with jQuery 2.1.0, throws exception -->
          <webDriverClassName>org.openqa.selenium.phantomjs.PhantomJSDriver</webDriverClassName>
          <webDriverCapabilities>
            <capability>
              <name>phantomjs.binary.path</name>
              <value>${phantomjs.binary}</value>
            </capability>
          </webDriverCapabilities>
        </configuration>
      </plugin>

    <!-- Minifying -->
    <plugin>
      <groupId>net.alchim31.maven</groupId>
      <artifactId>yuicompressor-maven-plugin</artifactId>
      <version>1.4.0</version>
      <executions>
        <execution>
          <id>minify</id>
          <phase>package</phase>
          <goals>
            <goal>compress</goal>
          </goals>
        </execution>
      </executions>
      <configuration>
        <nosuffix>false</nosuffix>
        <suffix>.min</suffix>
        <force>true</force>
        <sourceDirectory>${project.build.directory}/process_script</sourceDirectory>
        <outputDirectory>${script.output.dir}</outputDirectory>
      </configuration>
    </plugin>

  </plugins>

  <pluginManagement>
    <plugins>

      <!-- No stupid jgit warning in workspace, when some files are not yet
        committed -->
      <plugin>
        <groupId>org.eclipse.tycho</groupId>
        <artifactId>tycho-packaging-plugin</artifactId>
        <configuration>
          <timestampProvider>jgit</timestampProvider>
          <jgit.dirtyWorkingTree>warning</jgit.dirtyWorkingTree>
        </configuration>
      </plugin>

      <!-- No stupid error message in m2e. This long xml section is only necessary
        in tycho to make it not display a red error marker... -->
      <!--This plugin's configuration is used to store Eclipse m2e settings
        only. It has no influence on the Maven build itself. -->
      <plugin>
        <groupId>org.eclipse.m2e</groupId>
        <artifactId>lifecycle-mapping</artifactId>
        <version>1.0.0</version>
        <configuration>
          <lifecycleMappingMetadata>
            <pluginExecutions>
              <pluginExecution>
                <pluginExecutionFilter>
                  <groupId>
                    net.alchim31.maven
                  </groupId>
                  <artifactId>
                    yuicompressor-maven-plugin
                  </artifactId>
                  <versionRange>
                    [1.4.0,)
                  </versionRange>
                  <goals>
                    <goal>compress</goal>
                  </goals>
                </pluginExecutionFilter>
                <action>
                  <ignore></ignore>
                </action>
              </pluginExecution>
              <pluginExecution>
                <pluginExecutionFilter>
                  <groupId>com.github.klieber</groupId>
                  <artifactId>phantomjs-maven-plugin</artifactId>
                  <versionRange>[0.2.1,)</versionRange>
                  <goals>
                    <goal>install</goal>
                  </goals>
                </pluginExecutionFilter>
                <action>
                  <ignore></ignore>
                </action>
              </pluginExecution>
            </pluginExecutions>
          </lifecycleMappingMetadata>
        </configuration>
      </plugin>
    </plugins>
  </pluginManagement>

</build>

</project>
