/*******************************************************************************
 * Copyright (c) 2014-2015 BSI Business Systems Integration AG.
 * All rights reserved. This program and the accompanying materials
 * are made available under the terms of the Eclipse Public License v1.0
 * which accompanies this distribution, and is available at
 * http://www.eclipse.org/legal/epl-v10.html
 *
 * Contributors:
 *     BSI Business Systems Integration AG - initial API and implementation
 ******************************************************************************/
@wizard-progress-height: 60px;
@wizard-progress-border-width: 1px;
@wizard-progress-content-h-padding: 15px;
@wizard-progress-separator-width: 10px;
@wizard-progress-separator-line-width: 1px;

@wizard-progress-border-color: @border-color;
@wizard-step-after-current-background-color: @palette-blue-0;
@wizard-step-after-current-color: @wizard-step-default-color;
@wizard-step-after-current-separator-color: @wizard-step-default-separator-color;
@wizard-step-before-current-background-color: @palette-blue-0;
@wizard-step-before-current-color: @wizard-step-default-color;
@wizard-step-before-current-separator-color: @border-color;
@wizard-step-current-background-color: @active-inverted-background-color;
@wizard-step-current-color: @active-inverted-color;
@wizard-step-current-separator-color: @wizard-step-default-separator-color;
@wizard-step-default-background-color: @control-background-color;
@wizard-step-default-color: @control-color;
@wizard-step-default-separator-color: @border-color;
@wizard-step-disabled-background-color: @wizard-step-default-background-color;
@wizard-step-disabled-color: @palette-gray-6;
@wizard-step-disabled-separator-color: @wizard-step-default-separator-color;

#scout {

  .wizard-step-color(@color) {
    color: @color;
  }

  .wizard-step-background-color(@background-color) {
    background-color: @background-color;

    & .wizard-step-separator::after {
      border-left-color: @background-color;
    }
  }

  .wizard-step-separator-color(@separator-color) {
    & .wizard-step-separator::before {
      border-left-color: @separator-color;
    }
  }
}

.wizard-steps {
  overflow: hidden;
  margin-left: @mandatory-indicator-width;
  margin-right: 0;
  padding-bottom: @scrollbar-margin + (2 * @scrollbar-side-margin);
}

.wizard-steps-body {
  height: @wizard-progress-height;
  overflow: hidden;
  white-space: nowrap; /* Allows the last wizard-step to be 100% without line break */
  border: @wizard-progress-border-width solid @wizard-progress-border-color;
  /* This creates a new stacking context: */
  position: relative;
  z-index: 0;
}

.wizard-step {
  display: inline-block;
  height: @wizard-progress-height - (2 * @wizard-progress-border-width);
  line-height: @wizard-progress-height - (2 * @wizard-progress-border-width);
  position: relative;
  color: @wizard-step-default-color;
  background-color: @wizard-step-default-background-color;
  /* Spacing */
  padding-left: @wizard-progress-separator-width + @wizard-progress-content-h-padding;
  padding-right: @wizard-progress-content-h-padding;

  /* Step content */
  & > .wizard-step-content {
    display: inline-block;
    max-width: 200px;
    line-height: normal;
    vertical-align: middle;
    margin-top: -2px; /* TODO BSH Why is this necessary? inline-block seems to add some implicit margins, which causes the block not to be vertically centered */
    min-height: 30px;

    & > .wizard-step-title {
      #scout.overflow-ellipsis-nowrap();
      font-weight: bold;
    }
    & > .wizard-step-sub-title {
      #scout.overflow-ellipsis-nowrap();
    }
  }
  &.first {
    padding-left: @wizard-progress-content-h-padding;
  }
  &.last > .wizard-step-content {
    max-width: none;
  }

  /* Step separator */
  .wizard-step-separator {
    /* Arrow separators (::after is behind ::before) */
    &::after,
    &::before {
      content: '';
      display: inline-block;
      position: absolute;
      top: (@wizard-progress-height / 2) - @wizard-progress-border-width;
      left: 100%;
      height: 0;
      width: 0;
      margin-top: -((@wizard-progress-height / 2) + 4);
      border-top: ((@wizard-progress-height / 2) + 4) solid transparent;
      border-bottom: ((@wizard-progress-height / 2) + 4) solid transparent;
      border-left: @wizard-progress-separator-width solid transparent;
      z-index: 1; /* draw over next .wizard-step */
    }
    &::after {
      /* border-left-color must match background color of .wizard-step */
      border-left-color: @wizard-step-default-background-color;
    }
    &::before {
      margin-left: @wizard-progress-separator-line-width;
      border-left-color: @wizard-step-default-separator-color;
    }
  }

  /* Hover state */
  &.action-enabled:hover {
    cursor: pointer;

    & > .wizard-step-content > .wizard-step-title {
      text-decoration: underline;
    }
  }

  /* Step types */
  &.disabled {
    #scout.wizard-step-color(@wizard-step-disabled-color);
    #scout.wizard-step-background-color(@wizard-step-disabled-background-color);
    #scout.wizard-step-separator-color(@wizard-step-disabled-separator-color);
  }
  &:not(.disabled) {
    &.current {
      #scout.wizard-step-color(@wizard-step-current-color);
      #scout.wizard-step-background-color(@wizard-step-current-background-color);
      #scout.wizard-step-separator-color(@wizard-step-current-separator-color);
    }
    &.left-of-current {
      #scout.wizard-step-separator-color(@wizard-step-current-separator-color);
    }
    &.before-current {
      #scout.wizard-step-color(@wizard-step-before-current-color);
      #scout.wizard-step-background-color(@wizard-step-before-current-background-color);
      #scout.wizard-step-separator-color(@wizard-step-before-current-separator-color);
    }
    &.after-current {
      #scout.wizard-step-color(@wizard-step-after-current-color);
      #scout.wizard-step-background-color(@wizard-step-after-current-background-color);
      #scout.wizard-step-separator-color(@wizard-step-after-current-separator-color);
    }
  }
}

/* Special rules for wizard container form */
.form.wizard-container-form > .root-group-box {

  /* Remove the menubar border, instead the .wizard-steps's border will be used */
  & > .main-menubar {
    border-bottom: 0;
  }

  /* If wizard progress field is in the root-group-box, use negative margins to */
  /* draw it up to the border of the form (like the main-menubar itself). */
  & > .group-box-body > .wizard-progress-field > .wizard-steps {
    margin-left: -@root-group-box-padding-left;
    margin-right: -@root-group-box-padding-right;

    /* Align first and last step content with form fields */
    & > .wizard-steps-body {
      border-left: 0;
      border-right: 0;

      & > .wizard-step.first {
        padding-left: @root-group-box-padding-left + @mandatory-indicator-width;
      }
      & > .wizard-step.last {
        padding-right: @root-group-box-padding-right;
      }
    }
  }

  /* FIXME BSH Try to find a better solution */
  & > .group-box-body > .group-box > .group-box-body {
    padding-top: 0;
    padding-bottom: @group-margin-bottom;
  }
}
